CREATE OR REPLACE VIEW stg_sap_project FOLDER = '/03. staging views/sap'
    PRIMARY KEY ( 'projectkey' ) AS SELECT b_warehouse_edw_sap_project.projectkey AS projectkey, b_warehouse_edw_sap_project.projectid AS projectid, b_warehouse_edw_sap_project.profitcenter AS profitcenter, b_warehouse_edw_sap_project.loeprojectnum AS projectnum, case projectprofile WHEN 'Z000015' THEN b_warehouse_edw_sap_project.loeprojectnum ELSE NULL END AS projectnum_loe, dense_rank() OVER ( PARTITION BY profitcenter ORDER BY case projectprofile WHEN 'Z000015' THEN loeprojectnum ELSE NULL END DESC ) AS projectnum_loe_rank, case projectprofile WHEN 'Z000014' THEN b_warehouse_edw_sap_project.loeprojectnum ELSE NULL END AS projectnum_soe, dense_rank() OVER ( PARTITION BY profitcenter ORDER BY case projectprofile WHEN 'Z000014' THEN loeprojectnum ELSE NULL END DESC ) AS projectnum_soe_rank, b_warehouse_edw_sap_project.projectprofile AS projectprofile, b_warehouse_edw_sap_project.projectstatusid AS projectstatusid, b_warehouse_edw_sap_project.edwupdatedate AS edwupdatedate, b_warehouse_edw_sap_project.edwcreatedate AS edwcreatedate, row_number() OVER ( PARTITION BY profitcenter ORDER BY projectkey DESC ) AS profitcenter_duplicate_rank FROM b_warehouse_edw_sap_project;

